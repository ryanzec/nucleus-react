//NOTE: this is highly dependant on a real dom so can't unit test this code